<!DOCTYPE html>
<head>
    <title>{{.T.Comment}}列表</title>
    ${.Var.Header}
</head>
<body>

<div id="dg"></div>
<div class="gra-toolbar expo-toolbar toolBar">
    <div class="expo-param-fields clearfix">
        <ul>
            <li>
                <a class="gra-btn btn-add">
                    <i class="fa fa-plus" aria-hidden="true"></i>创建{{.T.Comment}}</a>
            </li>
            <li>
                <span class="title">关键字：</span>
                <input type="text" field="keyword"/>
            </li>

            <li>
                <input type="hidden" field="where" value="{.Map.Where}"/>
                <a class="gra-btn gra-btn-fn btn-search">
                    <i class="fa fa-search" aria-hidden="true"></i>搜索</a>
            </li>

        </ul>

        <div class="gra-toolbar-right">
            <div class="gra-btn btn-export">导出</div>
        </div>
    </div>
</div>

<template id="tpl_op">
    <a href="javascript:;" class="btn btn-short" onclick="_edit('{id}')">编辑</a>
    <!--<a href="javascript:;" class="btn btn-short" onclick="_list("{id}")">列表</a>-->
    <a href="javascript:;" class="btn btn-short" onclick="_del('{id}')">删除</a>
</template>

<script type="text/javascript" src="${.Var.StaticServe}/assets/js/base.js?spam=${.Var.Spam}"></script>
<script type="text/javascript">

    var baseJsUrl = "${.Var.StaticServe}"; //设置JS文件的路径
    require([baseJsUrl + "/assets/js/super/require_config.js?spam=${.Var.Spam}"], function () {
        require(["base", "jquery.easyui.zh", "x/export","x/util"], pageLoad);
    });

    var flag = 1;
    function pageLoad(_) {
        expo.portal = "{{.T.Prefix}}/{{.T.Title}}List";
        var opHtml = $b.html("tpl_op");
        $("#dg").datagrid({
            toolbar: ".toolBar",
            singleSelect: !false,
            pagination: true,
            rowNumbers: true,
            fitColumns: true,
            url: expo.getDataUrl(),
            columns: [
                [

        {{range $i,$c := .T.Columns}}
            {field: "{{$c.Name}}", title: "{{$c.Comment}}", align:"center", width: 100},
        {{end}}
                    {
                        field: "Id", title:"操作", align:"center", width: 120, formatter: function (val, row) {
                        return $b.template(opHtml, row);
                    }
                    },
                ]
            ]
        });
        $b.$fn(".btn-search").click(_search);
        $b.$fn(".btn-add").click(_create);
        $b.$fn(".bt-export").click(function(){
            expo.showExportDialog();
        });
    }
    
    
    function _create() {
        var d = $b.dialog.create2("添加{{.T.Comment}}", true, true);
        d.open("Create{{.T.Title}}", 600, 400);
        // $b.tab.open("创建{{.T.Comment}}", "Create{{.T.Title}}", true);
    }
    
    function _search() {
        expo.search("dg");
    }

    function _edit(id) {
        var d = $b.dialog.create2("修改{{.T.Comment}}", true, true);
        d.open("edit{{.T.Title}}?id=" + id, 600, 400);
        // $b.tab.open("修改{{.T.Comment}}", "edit{{.T.Title}}?id="+id, true);
    }

    <!--
    function _list(id){
        $b.tab.open("{{.T.Comment}}", "List?group_id="+id, true);
    }
    -->

    function _del(id) {
        $b.dialog.confirm("删除后不可恢复，您确定要继续吗？", function (r) {
            if (!r) {return;}
            if(flag) {
                flag = 0;
                $b.xhr.jsonPost("del{{.T.Title}}", {id: id}, function (r) {
                    flag = 1;
                    if (r.result) {
                        window.refresh()
                    } else {
                        $b.dialog.alert(r.message);
                    }
                });
            }
        });
    }
</script>

</body>
</html>